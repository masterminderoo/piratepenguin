<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pirate Penguin Budapest</title>

  <script>
  (function() {
    // Pr√ºfen, ob der automatische Check schon durchgef√ºhrt wurde
    if (!sessionStorage.getItem('firstVisitDone')) {
      const userLang = navigator.language || navigator.userLanguage;
      if(userLang && userLang.toLowerCase().startsWith('de')) {
        // Weiterleiten auf Deutsch, wenn Browser-Sprache deutsch ist
        if(!window.location.pathname.includes('index-de.html')) {
          // Automatischen Check als erledigt markieren
          sessionStorage.setItem('firstVisitDone', 'true');
          window.location.href = 'index-de.html' + window.location.search;
          return; // wichtig, um weiteren Code zu stoppen
        }
      }
      // Automatischen Check als erledigt markieren, wenn keine Weiterleitung n√∂tig
      sessionStorage.setItem('firstVisitDone', 'true');
    }
  })();
</script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #fefefe; color: white; }
    header { background: #222; color: white; padding: 1.5rem; text-align: center; }
    header h1 { margin: 0; font-size: 2rem; }
    header p { margin: 0.5rem 0 0; font-size: 1.2rem; }
    .section { padding: 2rem 1rem; max-width: 800px; margin: auto; }
    .highlight { background: #f4f4f4; border-left: 5px solid #222; padding: 1rem; margin: 1rem 0; }
    .tour-info td { padding: 0.5rem; }
    .cta-button { background: #222; color: white; padding: 1rem 2rem; border: none; font-size: 1rem; cursor: pointer; display: block; margin: 2rem auto; text-decoration: none; text-align: center; width: fit-content; border-radius: 5px; }
    footer { text-align: center; padding: 1rem; font-size: 0.9rem; color: #666; }
    .calendar-container { text-align: center; }
    .calendar { border-collapse: collapse; margin: 0 auto; font-size: 1rem; }
    .calendar th, .calendar td { width: 30px; height: 30px; text-align: center; border: 1px solid #ddd; }
    .calendar th { background-color: #222; color: white; }
    .calendar td { cursor: pointer; padding: 10px; }
    .calendar td:hover { background-color: #f4f4f4; }
    .language-switcher {display: flex; gap: 35px; justify-content: center; align-items: center;}
    .flag-icon {  border-radius: 4px;}
    .flag-icon.selected { border:2px solid gold; }
  </style>
</head>
<body>
  <header>
    <img src="./piratepengulogosmall.png" alt="Pirate Penguin Logo" style="width: 350px; height: auto;" />
    <h1>Schnitzeljagd mit verdeckten Rollen</h1>
    <p>Entdecke Budapests verborgenen Schatz</p>
  </header>

      <link rel="stylesheet" href="css/style.css" />

  <section class="section">
    <div class="language-switcher">
    <a href="index.html"><img src="./flag-uk.png" alt="English" width="48" height=auto class="flag-icon"></a>
    <a href="index-de.html"><img src="./flag-de.png" alt="Deutsch" width="48" height=auto class="flag-icon selected"></a>
    </div>
    <h2>Was dich erwartet</h2>
    <p>Ich bin nicht dein Leiter - Ich bin dein Captain! Pirate Penguin ist ein <strong>Detektivspiel durch Budapest</strong>, bei dem du sowohl die Stadt selbst
      als auch deine Mitspieler unter die Lupe nehmen musst. Aber Vorsicht! Nicht jedes Crewmitglied ist dir wohlgesonnen...</p>
    <p>Du und deine Mitabenteurer bekommen jeweils eine <strong>verdeckte Rolle</strong> mit seltsamen Regeln und geheimen Zielen. 
    Jetzt liegt es an euch herauszufinden, wer sich merkw√ºrdig verh√§lt ‚Äì und warum. 
    Schafft ihr es, die R√§tsel der Schatzsuche zu l√∂sen, ohne euch von den anderen Rollen ablenken zu lassen?</p>
    <p>Egal ob du <strong>das R√§tsel l√∂sen</strong>, <strong>das Chaos genie√üen</strong> oder einfach nur <strong>deine Freunde in den Wahnsinn treiben</strong> 
      willst: Pirate Penguin ist ein Erlebnis, das du so schnell nicht vergessen wirst!</p>
    <div class="highlight">
      <ul>
        <p>‚öì Keine trockenen Vortr√§ge. Kein langweiliger Geschichtsunterricht. Nur pures Abenteuer, geleitet von einem erfahrenen Pinguinkapit√§n</p>
        <p>üêß L√∂se R√§tsel, knacke Geheimcodes, und entdecke versteckte Orte in ganz Budapest</p>
        <p>üè¥‚Äç‚ò†Ô∏è √úberliste Verr√§ter, enttarne geheime Rollen, und schnapp deinen Mitspielern den Schatz vor der Nase weg</p>
      </ul>
    </div>
  </section>

  <section class="section">
    <h2>Spione an Bord?</h2>
    <img src="./piratepenguinroles.jpg" alt="City Highlights" style="width: 800px; height: auto;">
    <p>Redet Daniel gerade mit einem Laternenpfosten, weil er <strong>Der verfluchte Matrose</strong> ist, oder ist er einfach nur ein wenig seltsam? 
      Erz√§hlt Maria alles in einem √ºberdramatischen Tonfall, weil sie <strong>Die Geschichtenerz√§hlerin</strong> ist, oder redet sie einfach immer so? 
      Du wirst es erst bei der gro√üen Aufl√∂sung am Ende erfahren, aber so oder so wird es zum Schreien komisch!</p> 
    <p>Kurz vor Spielbeginn w√§hlt der Kapit√§n eine Rolle f√ºr dich aus einer Liste von <strong>√ºber 50 Rollen</strong> aus ‚Äì abgestimmt auf die anderen Rollen, 
    die er f√ºr diese Session geplant hat. Du bekommst dann eine E-Mail mit deiner Rollenkarte, einer kurzen Erkl√§rung zu deinen F√§higkeiten/Zielen 
    und ein paar Tipps und Tricks, wie du deine Rolle am besten spielst.</p>
    <img src="./ppromodeutsch.jpg" alt="City Highlights" style="width: 500px; height: auto; border-radius: 5px;">
  </section>


 <section class="section">
  <h2>W√§hle dein Abenteuer!</h2>
  <div class="gallery">
    <div class="gallery-item" onclick="updateDetails('tour1')">
      <img src="./piratepengulangos.jpg" alt="City Highlights" style="width: 280px; height: auto;">
      <div class="overlay">Schatz & Schmaus</div>
    </div>
    <div class="gallery-item" onclick="updateDetails('tour2')">
      <img src="./piratepenguboardgame.jpg" alt="Food & Culture" style="width: 280px; height: auto;">
      <div class="overlay">Zocken & Pl√ºndern</div>
    </div>
    <div class="gallery-item" onclick="updateDetails('tour3')">
      <img src="./piratepenguboat.jpg" alt="Hidden Gems" style="width: 280px; height: auto;">
      <div class="overlay">Privates Abenteuer</div>
    </div>
  </div>
</section>

<!-- Dynamic Details Section -->
<section class="section">
  <h2></h2>
  <div id="details">
    <p>Klicke auf ein Bild, um Details zu sehen.</p>
  </div>
    <button id="backButton" onclick="resetDetails()" style="display: none;">Back to Events</button>
</section>


  <section class="section">
    <h2>Anker lichten!</h2>
    <p>W√§hle ein Datum, um dein Ticket zu kaufen:</p>
    <div class="calendar-container">
      <table class="calendar">
        <thead>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
    <div id="booking-form" style="display: none; margin-top: 20px; background: #fff; color: black; padding: 20px; border-radius: 8px; max-width: 500px; margin-left: auto; margin-right: auto;">
  <h3>Reserve Your Spot</h3>
  <h3 id="selected-date"></h3>
  <form action="https://formsubmit.co/captain@piratepenguinbudapest.com" method="POST">
    <input type="hidden" name="referrer" id="refInput">
    <script>
    document.getElementById("refInput").value = sessionStorage.getItem("ref") || '';
    </script>
    <input type="hidden" name="_captcha" value="false">
    <input type="hidden" name="tour_date" id="form-date">
    <label for="name">Name:</label><br>
    <input type="text" id="name" name="name" required><br><br>

    <label for="email">Email:</label><br>
    <input type="email" id="email" name="email" required><br><br>

    <label for="participants">Anzahl der Teilnehmer:</label><br>
    <input type="number" id="participants" name="participants" min="1" max="5" value="1" required><br><br>

    <label>
    <input type="checkbox" id="cashOption" name="cashOption">
    Ich m√∂chte lieber vor Ort in bar zahlen (+1000Ft/3‚Ç¨ Reservierungsgeb√ºhr)
    </label>

    <div id="priceSummary" class="price-summary" style="margin-top: 15px; font-weight: bold;">
    <!-- Dynamischer Preis wird hier eingef√ºgt -->
    </div>

    <button type="submit" class="cta-button">Jetzt Reservieren</button>

    <input type="hidden" name="_next" id="redirect-url">

  </form>
</div>

  </section>

<script>
  const params = new URLSearchParams(window.location.search);
  const ref = params.get("ref");
  if (ref) {
    sessionStorage.setItem("ref", ref);
  }
  
  function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' };
    return date.toLocaleDateString('en-GB', options).replace(/\//g, '.');
  }

  let expandedRow = null;

  async function fetchBookings() {
    const apiUrl = 'https://script.google.com/macros/s/AKfycby1BI5Bf1kFrGzWV86K8-5uCQaIvfAChptNfsL0jQMPnL143TZqnFFEiO7yWNei7oU7/exec';

    try {
      const response = await fetch(apiUrl);
      const data = await response.json();
      const calendar = document.querySelector('.calendar');

      // Create table headers
      const headers = `
        <thead>
          <tr>
            <th class="header-gold">Datum</th>
            <th class="header-gold">Skript</th>
            <th class="header-gold">Startzeit</th>
            <th class="header-gold">Freie Pl√§tze</th>
          </tr>
  </thead>
        <tbody></tbody>`;
      calendar.innerHTML = headers;

      const tbody = calendar.querySelector('tbody');

      data.forEach((row, index) => {
        const formattedDate = formatDate(row.date);
        const isFull = parseInt(row.spotsLeft) === 0;
        const spotsLeftStyle = isFull ? 'style="background-color: #B22222; color: white; font-weight: bold;"' : '';
        const bgColor = index % 2 === 0 ? '#8B4513' : '#A0522D';

        const tr = document.createElement('tr');
        tr.style.backgroundColor = bgColor;
        tr.innerHTML = `
          <td>${formattedDate}</td>
          <td>${row.tourName}</td>
          <td>${row.participants}</td>
          <td ${spotsLeftStyle}>${row.spotsLeft}</td>
        `;

  if (parseInt(row.spotsLeft) > 0) {
  tr.addEventListener('click', () => {
  // Vorherige erweiterte Zeile oder Formular ausblenden
  if (expandedRow && expandedRow.parentNode) {
    expandedRow.parentNode.removeChild(expandedRow);
    if (expandedRow.previousSibling === tr) {
      expandedRow = null;
      // Formular ausblenden, wenn dasselbe Datum nochmal geklickt wird
      const bookingForm = document.getElementById('booking-form');
      if (bookingForm) bookingForm.style.display = 'none';
      return;
    }
  }

  // Formular anzeigen und mit Datum f√ºllen
  const bookingForm = document.getElementById('booking-form');
  if (bookingForm) {
    bookingForm.style.display = 'block';
    updatePriceSummary();

    // Datum formatieren und anzeigen
    const formattedDate = formatDate(row.date);
    const selectedDateEl = document.getElementById('selected-date');
    if (selectedDateEl) selectedDateEl.textContent = `You selected: ${formattedDate}`;

    const formDateInput = document.getElementById('form-date');
    if (formDateInput) formDateInput.value = row.date; // rohes Datum ins Hidden-Feld

    bookingForm.scrollIntoView({ behavior: 'smooth' });
  }
        });
  } else {
  tr.title = "This event is fully booked";
  tr.addEventListener('click', () => {
    // Find the Start Time cell in this row (3rd cell, index 2)
    const startTimeCell = tr.cells[2];
    if (startTimeCell) {
      // Toggle the text between original and custom message
      if (startTimeCell.dataset.originalText === undefined) {
        // Save original text in a data attribute
        startTimeCell.dataset.originalText = startTimeCell.textContent;
      }

      if (startTimeCell.textContent !== "Fully booked") {
        startTimeCell.textContent = "Fully booked";
      } else {
        // Toggle back to original
        startTimeCell.textContent = startTimeCell.dataset.originalText;
      }
    }
  });
}

        tbody.appendChild(tr);
      });
    } catch (error) {
      console.error('Error fetching data:', error);
    }
  }

  window.onload = fetchBookings;

function updatePriceSummary() {
  const numParticipants = parseInt(document.getElementById('participants').value) || 1;
  const cashSelected = document.getElementById('cashOption').checked;
  const basePrice = numParticipants * 8000;
  const cashFee = cashSelected ? 1000 : 0;
  const total = basePrice + cashFee;
  const priceHTML = `
    <div>Base price: 8000 Ft x ${numParticipants} = <strong>${basePrice}‚ÄØFt</strong></div>
    ${cashSelected ? `<div>Reservation fee: <strong>+1000‚ÄØFt</strong></div>` : ''}
    <div style="margin-top: 5px;">Total: <strong>${total}‚ÄØFt</strong></div>
  `;

  document.getElementById('priceSummary').innerHTML = priceHTML;
}

  // Preis automatisch aktualisieren, wenn Teilnehmerzahl oder Checkbox ge√§ndert wird
document.addEventListener('DOMContentLoaded', () => {
  const participantsInput = document.getElementById('participants');
  const cashCheckbox = document.getElementById('cashOption');

  if (participantsInput) {
    participantsInput.addEventListener('input', updatePriceSummary);
  }

  if (cashCheckbox) {
    cashCheckbox.addEventListener('change', updatePriceSummary);
  }
});

   const form = document.getElementById("booking-form");

  document.querySelector("form").addEventListener("submit", function (e) {
    const form = e.target;
    const date = document.getElementById("form-date").value;
    const participants = document.getElementById("participants").value;
    const webhookUrl = "https://script.google.com/macros/s/AKfycby1BI5Bf1kFrGzWV86K8-5uCQaIvfAChptNfsL0jQMPnL143TZqnFFEiO7yWNei7oU7/exec";

    fetch(webhookUrl, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `tour_date=${encodeURIComponent(date)}&participants=${encodeURIComponent(participants)}`
    }).then(response => {
      // Optional: Log oder Best√§tigung
      console.log("Webhook request sent");
    }).catch(error => {
      console.error("Error updating spotsLeft:", error);
    });
  });

  form.addEventListener("submit", function(event) {
    const cashOptionChecked = document.getElementById("cashOption").checked;
    const participants = parseInt(document.getElementById("participants").value, 10);
    // Redirect-URLs je nach Zahlungsmethode
    const redirectUrl = cashOptionChecked
      ? "https://piratepenguinbudapest.com/thanks-cash.html"
      : "https://piratepenguinbudapest.com/thanks-online.html";

    // Setze Redirect-URL dynamisch
    document.getElementById("redirect-url").value = redirectUrl;

    // Nur wenn NICHT Barzahlung gew√§hlt wurde, soll der Revolut-Link aufgehen
    if (!cashOptionChecked) {
      const revolutLinks = {
        1: "https://checkout.revolut.com/pay/abbc46b6-05a2-499f-8126-69831c81ceb0",
        2: "https://checkout.revolut.com/pay/c41aa667-ca4a-47b5-a6b6-478dbd4f24ae",
        3: "https://checkout.revolut.com/pay/1cb6b13e-0998-40ac-b2ac-eced4b187353",
        4: "https://checkout.revolut.com/pay/090633d9-e500-4b92-a1fa-08eab50c3985",
        5: "https://checkout.revolut.com/pay/88a688ca-7ec2-4a50-bbab-dea8bbc56a34"
      };

      const payLink = revolutLinks[participants];
      if (payLink) {
        window.open(payLink, "_blank");
      }
    }
  });
  
</script>
 
  <section class="section">
    <h2>Fragen und Antworten</h2>
    <div class="highlight">
      <ul>
  <p><strong>Ben√∂tige ich Vorkenntnisse in Schatzsuchen oder Social-Deduction-Spielen?</strong><br>
      √úberhaupt nicht! Egal ob erfahrener Freibeuter oder frischer Matrose, alle sind willkommen.
    Ich erkl√§re die Regeln ausf√ºhrlich vor Spielbeginn, und w√§hrend des Spiels kannst du mir jederzeit Fragen stellen.</p>
  <p><strong>Was wenn mir meine Rolle nicht gef√§llt?</strong><br>
  Ich mag zwar ein Pirat sein, der einst seinen eigenen Kapit√§n meuterte (die Haie hatten an dem Tag ein Festmahl), aber herzlos bin ich nicht. 
    Falls du mit deiner Rolle unzufrieden bist, schick mir bitte <strong>vor Spielbeginn</strong> eine E-Mail ‚Äì
    wir finden gemeinsam eine L√∂sung (in den meisten F√§llen bekommst du einfach eine neue Rolle).</p>

  <p><strong>Was passiert, wenn es am Spieltag regnet? Wird das Event abgesagt oder verschoben?</strong><br>
  Arrrr, h√§ltst du mich etwa f√ºr eine Landratte?! Ein wahrer Pirat trotzt jedem Sturm, also werden wir das Spiel wie geplant durchziehen, selbst wenn es 
    ein bisschen regnet. Sollte es allerdings so heftig in Str√∂men gie√üen, dass Noah wieder eine Arche bauen muss, werde ich das Event absagen und allen
    Teilnehmern den vollen Preis zur√ºckerstatten.

  <p><strong>In welchen W√§hrungen kann ich bezahlen?</strong><br>
  Du kannst in Euro(‚Ç¨) oder Forint(HUF) zahlen.</p>

  <p><strong>Darf ich eigenes Essen und Trinken mitbringen?</strong><br>
    Na klar! Auch wenn es unterwegs viele M√∂glichkeiten gibt, etwas zu kaufen, kannst du gerne eigene Snacks und Getr√§nke mitbringen. 
    Bitte beachte aber, dass laut ungarischem Gesetz Alkohol im √∂ffentlichen Raum verboten ist, also nimm nur alkoholfreie Getr√§nke mit.</p>

  <p><strong>In welcher Sprache findet das Event statt?</strong><br>
    Die meisten Events finden auf Englisch statt, aber etwa 1‚Äì2 Mal pro Monat biete ich auch eine deutsche Runde an! 
    Wenn im Kalender beim Event (German) oder (Deutsch) steht, ist das jeweilige Event auf Deutsch. Wenn nichts dabeisteht, ist es auf Englisch.</p>
      </ul>
    </div>
  </section>
  
  <footer>
    <p>&copy; 2025 Pirate Penguin Budapest</p>
    <a href="./terms-of-service.html">Allgemeine Gesch√§ftsbedingungen</a> | 
    <a href="./privacy-policy.html">Datenschutzerkl√§rung</a> |
    <a href="./imprint.html">Impressum</a>
  </footer>
  
  <script>
  const tours = {
    tour1: {
      title: "Schatz & Schmaus",
      description: "L√ºfte das Geheimnis der Sternenj√§ger im 5. Bezirk und knacke r√§tselhafte Hinweise rund um die Donau! Das Essen zwischen den R√§tseln ist optional ‚Äì aber sehr empfehlenswert.",
      price: "8.000Ft (20‚Ç¨) pro Person",
      duration: "2,5 Stunden",
      language: "Szent Istvan Ter 1 (vor der Basilika)",
      ideal: "Schatzsucher, Essensliebhaber, Einzelpersonen, Kleinere Freundesgruppen"
    },
    tour2: {
      title: "Zocken & Pl√ºndern",
      description: "R√§tsle dich durch den 6. Bezirk und finde den Schatz der Brettspielbar! Spieltickets f√ºr die Bar sind im Preis inbegriffen.",
      price: "10.000Ft (25‚Ç¨) pro Person",
      duration: "3 Stunden",
      language: "Andrassy Utca 22 (vor der Oper)",
      ideal: "Brettspielfans, Videospielfans, Leute die gerne unbekanntere Gebiete erforschen"
    },
    tour3: {
      title: "Privates Abenteuer",
      description: "Nur mit deiner Crew unterwegs sein ‚Äì ganz ohne fremde Matrosen? Oder willst du, dass der K√§pt‚Äôn zu dir nach Hause kommt und deine Geburtstagsparty in ein Social-Deduction-Fest verwandelt? Aye! Mit diesem privaten Paket bekommst du ein ma√ügeschneidertes Erlebnis nur f√ºr dich.",
      price: "Individueller Preis je nach Dauer, Anlass, und Gruppengr√∂√üe",
      duration: "Du entscheidest!",
      language: "5., 6., 7., 8., oder 13. Bezirk",
      ideal: "Familien, gro√üe Freundesgruppen, Leute die ihre Party immer auf den letzten Dr√ºcker planen (ja, Michael, du bist gemeint)"
    }
  };

 // Function to update details dynamically and scroll to the details section
function updateDetails(tour) {
  const details = document.getElementById("details");
  const backButton = document.getElementById("backButton");
  const detailsSection = document.querySelector('.section:nth-of-type(4)'); // The section containing details
  
  // Change content dynamically
  details.innerHTML = `
    <h2>${tours[tour].title}</h2>
    <p>${tours[tour].description}</p>
    <p><strong>Preis:</strong> ${tours[tour].price}</p>
    <p><strong>Dauer:</strong> ${tours[tour].duration}</p>
    <p><strong>Treffpunkt:</strong> ${tours[tour].language}</p>
    <p><strong>Am besten geeignet f√ºr:</strong> ${tours[tour].ideal}</p>
    
    
  `;
  
  // Show details with smooth fade-in
  details.classList.add("show");

  // Show the back button
  backButton.style.display = "inline-block";

  // Scroll to the details section with smooth scrolling
  detailsSection.scrollIntoView({ behavior: 'smooth' });
}

// Function to reset details and hide them, then scroll back to the tours gallery
function resetDetails() {
  const details = document.getElementById("details");
  const backButton = document.getElementById("backButton");
  const gallerySection = document.querySelector('.section:nth-of-type(3)'); // The section containing the gallery
  
  // Reset content to default message
  details.innerHTML = `<p>Select a tour to see the details.</p>`;
  
  // Hide details and back button with a fade-out effect
  details.classList.remove("show");
  backButton.style.display = "none";

  // Scroll back to the gallery section with smooth scrolling
  gallerySection.scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
